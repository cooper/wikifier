# PHP Wikiclient

This is a PHP interface to Wikifier::Server.

## Constructor

Create a new wikiclient instance.
```php
$wikiclient = new Wikiclient($path, $wiki_name, $wiki_pass, $session_id);
```

* __$path__ - Path the wikifier UNIX socket.
* __$wiki_name__ - shortname of the wiki. This is the one used in the wikiserver
  configuration file.
* __$wiki_pass__ - password for read access to the wiki. This is also set
  in the wikiserver configuration file.
* __$session_id__ - _optional_, a string which identifies a logged in user.
  Once the user logs in initially with [`->login()`](#login), the session ID can
  be used to resume the session on each page load without having to send the
  username and password again. This is only useful if you need write access to
  the wiki from this wikiclient.

## High-level methods

### login

```php
$wikiclient->login($username, $password, $session_id);
```

Used to obtain write access to this wiki. This is not needed if you are only
going to be reading with this wikiclient.

* __$username__ - account username.
* __$password__ - account password.
* __$session_id__ - _optional_, a string which will later be used to re-identify
  the user without having to send the username and password again. See the
  [constructor](#constructor) for more information.

Returns an object with properties.
* __->logged_in__ - true if the login was successful.
* __->incorrect__ - true if the credentials were incorrect.
* __->name__ - user's real name, if configured.
* __->email__ - user's email, if configured.
* May return an [error](#errors) instead.

### page

```php
$wikiclient->page($name);
```

Requests the HTML for a page.

* __$name__ - the page name, with or without the `.page` extension.

Returns an object with properties:
* __->title__ - human-readable title, as defined by `@page.title`.
* __->content__ - HTML page content.
* __->css__ - CSS page content.
* __->all_css__ - for pages, this is the same as `->css`.
* __->categories__ - array of category names the page belongs to.
* __->modified__ - time string at which the page was last modified. this is
  formatted for use in a `Last-Modified` header.
* __->created__ - UNIX timestamp at which the page was created, if available.
* __->generated__ - true if the page was just generated by this request.
* __->cached__ - true if `->content` came from a cached HTML file.
* __->cache_gen__ - true if this request resulted in writing a new cache file.
* __->file__ - page filename relative to the wiki's page root `@dir.page`.
* __->path__ - absolute path to the page filename.
* __->type__ - `"page"`.
* __->mime__ - `"text/html"`. for `Content-Type` header.
* __->length__ - byte length of `->content`. for `Content-Length` header.
* May return an [error](#errors) instead.

### page_code

```php
$wikiclient->page_code($name);
```

Requests the Wikifier source code for a page.

Returns an object with properties:
* __->content__ - page's Wikifier source code.
* __->file__ - page filename relative to the wiki's page root `@dir.page`.
* __->path__ - absolute path to the page filename.
* __->type__ - `"page_code"`.
* __->mime__ - `"text/plain"`. for `Content-Type` header.
* __->length__ - byte length of `->content`. for `Content-Length` header.
* May return an [error](#errors) instead.

### page_list

```php
$wikiclient->page_list($sort);
```

Fetches the list of all pages on the wiki.

* __$sort__ - a hint for how the pages should be sorted. Format is one of
`a` (alphabetical by page name), `c` (by creation date), `m`
(by modification date), or `u` (alphabetical by author name); followed by `+`
for ascending or `-` for descending. Default `m-` (recently-modified first).

Returns an object with properties:
* __->pages__ - array of page objects. Objects are in the same format as
  returned by [catposts](#catposts), except that the `->content` is omitted.

### image

```php
$wikiclient->image($name, $width, $height);
```

* __$name__ - image filename, relative to the wiki image root `@dir.image`.
* __$width__ - _optional_, desired image width, in pixels.
  If provided, `$height` must also be provided.
* __$height__ - _optional_, desired image height, in pixels.
  If provided, `$width` must also be provided.
* If neither `$width` nor `$height` are provided, the full-sized image is used.

Fetches information about an image. Note that the image data itself is not
delivered via the wikiserver transport. Instead, the HTTPd should serve the
image directly.

Returns an object with properties:
* __->image_type__ - `"jpeg"` or `"png"`.
* __->modified__ - time string at which the image was last modified. this is
  formatted for use in a `Last-Modified` header.
* __->file__ - image filename with requested dimensions,
  relative to wiki image root `@dir.image`.
* __->path__ - absolute path to the image at requested dimensions.
* __->fullsize_path__ - absolute path to the full-sized image.
* __->mime__ - image mimetype. for `Content-Type` header.
* __->length__ - image bytesize. for `Content-Length` header.
* __->etag__ - string to identify this version of the image. for `Etag` header.
* __->type__ - `"image"`.
* __->generated__ - true if the image was just generated by this request.
* __->cached__ - true if the image is cached at the requested dimensions.
* __->cache_gen__ - true if this request resulted in writing a new cached image.
* May return an [error](#errors) instead.

### catposts

```php
$wikiclient->catposts($name, $page_n);
```

### page_save

```php
$wikiclient->page_save($name, $content, $message);
```

### page_del

```php
$wikiclient->page_del($name);
```

### page_move

```php
$wikiclient->page_move($name, $new_name);
```

## Low-level methods

These methods usually aren't used directly.

### connect

```php
$wikiclient->connect();
```

Connects to the wikiserver. You don't have to call this directly, as other
methods will automatically connect if needed.

### command

```php
$wikiclient->command($command, $opts);
```

Sends a raw command to the wikiserver. You shouldn't have to use this directly,
since the other high-level methods wrap it.

## Errors

Methods that might fail can return errors. In such a case, the return values
listed elsewhere will not be present. These values will be there instead:
* __->response__: `"error"`. Normally this would instead be the type of reply.
* __->type__: type of error.
* __->reason__: human-readable error message.
* __->draft__: true if the error is because the content is marked as draft and
  you are not allowed to see it yet.
